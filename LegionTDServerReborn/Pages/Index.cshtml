@page
@using LegionTDServerReborn.Models
@using LegionTDServerReborn.Extensions
@using LegionTDServerReborn.Helpers
@using Microsoft.AspNetCore.Html
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<h1>Welcome to Legion TD Reborn</h1>

<div class='row'>
    @{
        var dictionary = new Dictionary<string, string>();
        dictionary["Monthly Players"] = $"{Model.MonthlyPlayers}";
        dictionary["Daily Matches"] = $"{Model.DailyMatches}";
        @foreach (var pair in dictionary) {
            <div class='col-md-6 col-sm-6 col-xs-6 match-info'>
                <p class='match-info-title text-center'>@pair.Key</p>
                <p class='match-info-value text-center'>@Html.Raw(pair.Value)</p>
            </div>
        }
    }
</div>

<div id='daily_player_plot'></div>

<a href='https://github.com/n-gao/LegionTD-Reborn'>
    <img src='~/images/GitHub-Mark-64px.png' alt='GitHub Logo'>
</a>

<a href='https://steamcommunity.com/sharedfiles/filedetails/?id=541930328'>
    <img src='~/images/steam-icon.png' alt='Steam Logo'>
</a>

@section scripts {
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script>
        $.ajax({
            url: '/api/legiontd',
            type: 'get',
            data: {method : 'matches_per_day', numDays : 92},
            success: function(data) {
                console.log(data);
                x = [];
                var trace = {
                    x : data.map(v => new Date(v.name.year, v.name.month - 1, v.name.day)),
                    y : data.map(v => v.count),
                    type : 'scatter',
                    displayModeBar : false
                };
                var layout = {
                    title: 'Daily Matches',
                    showlegend: false,
                    margin: {
                        l: 32,
                        r: 0,
                        b: 32,
                        t: 50
                    }
                };
                Plotly.newPlot('daily_player_plot', [trace], layout, {displayModeBar : false});
            }
        });
    </script>
}
