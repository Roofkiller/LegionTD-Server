@page "{site:int?}"
@using LegionTDServerReborn.Models
@using LegionTDServerReborn.Extension
@using Microsoft.AspNetCore.Html
@model RankingModel
@{
    ViewData["Title"] = "Ranking";
}

<h2>Ranking</h2>

<p>
    @if (Model.Site > 1) {
        <a href="/Ranking/1" class='matches-site'>« First</a>
        <a href="/Ranking/@(Model.Site - 1)" class='matches-site'>‹ Prev</a>
    }
    @if (Model.Site >= 6) {
        <span clkass='matches-site'>...</span>
    }
    @{
        for (int j = Model.Site - 4; j < Model.Site; j++) {
            if (j <= 0) {
                continue;
            }
            <a href='/Ranking/@j' class='matches-site'>@j</a>
        }
    }
    <span class='matches-site matches-site-current'>@Model.Site</span>
    @{
        for (int j = Model.Site + 1; j <= Model.Site + 4; j++) {
            if (j >= Model.PageCount - 1) {
                continue;
            }
            <a href='/Ranking/@j' class='matches-site'>@j</a>
        }
    }
    @if (Model.Site < Model.PageCount - 4) {
        <span clkass='matches-site'>...</span>
    }
    @if (Model.Site < Model.PageCount) {
        <a href="/Ranking/@(Model.Site + 1)" class='matches-site'>Next ›</a>
        <a href="/Ranking/@(Model.PageCount)" class='matches-site'>Last »</a>
    }
</p>
<div class='table-responsive'>
    <table class='table table-striped table-hover'>
        <col width=10%><col width=80%><col width=10%>
        <thead>
            <tr>
                <th>
                    Rang
                </th>
                <th>
                    Player
                </th>
                <th>
                    Rating
                </th>
            </tr>
        </thead>
        <tbody>
            @{
                int i = 1;
                Func<Player, IHtmlContent> printPlayer = 
                    @<tr class='clickable-row' data-href='/Player/@item.SteamId'>
                        <td>@(i++ + (Model.Site - 1) * RankingModel.PlayersPerSite)</td>
                        @try {
                            <td><img src='@Model.SteamPlayers[item.SteamId].Avatar'> @Model.SteamPlayers[item.SteamId].PersonaName</td>
                        } catch(Exception) {
                            <td>@item.SteamId</td>
                        }
                        <td>@item.Rating</td>
                    </tr>;
                foreach(var player in @Model.Players) {
                    @printPlayer(player)
                }
            }
        </tbody>
    </table>
</div>
<p>
    @if (Model.Site > 1) {
        <a href="/Ranking/1" class='matches-site'>« First</a>
        <a href="/Ranking/@(Model.Site - 1)" class='matches-site'>‹ Prev</a>
    }
    @if (Model.Site >= 6) {
        <span clkass='matches-site'>...</span>
    }
    @{
        for (int j = Model.Site - 4; j < Model.Site; j++) {
            if (j <= 0) {
                continue;
            }
            <a href='/Ranking/@j' class='matches-site'>@j</a>
        }
    }
    <span class='matches-site matches-site-current'>@Model.Site</span>
    @{
        for (int j = Model.Site + 1; j <= Model.Site + 4; j++) {
            if (j >= Model.PageCount - 1) {
                continue;
            }
            <a href='/Ranking/@j' class='matches-site'>@j</a>
        }
    }
    @if (Model.Site < Model.PageCount - 4) {
        <span clkass='matches-site'>...</span>
    }
    @if (Model.Site < Model.PageCount) {
        <a href="/Ranking/@(Model.Site + 1)" class='matches-site'>Next ›</a>
        <a href="/Ranking/@(Model.PageCount)" class='matches-site'>Last »</a>
    }
</p>

@section scripts {
    <script>
        $(function () {
            $(".clickable-row").click(function() {
                    window.location = $(this).data("href");
                });
        });
    </script>
}
